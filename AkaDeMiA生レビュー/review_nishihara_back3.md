お疲れ様です。
とてもよくできていると思います！
この調子で頑張ってください！


## requirements.txtの更新について

前回のレビュー後に、それを受けてrequirements.txtを更新してくれたと思うのですが、debug_toolbarなど、課題3で新たに追加したpackageなどが抜けていたりしたので、こまめに更新することをお勧めします。  
というのも、チームで開発している時に、全員で同じ環境をそろえるのが大事だったり、個人でリポジトリを公開するときも、再現しやすい配慮が必要だからです。  
めちゃくちゃ小言だし、面倒くさいことなのですが、レポートや論文における参考文献のようなものだと思って欲しいです。参考文献と違い、pip freezeと1コマンド打てばすむうえ、そういうのがしっかりしてないだけで評価とか色んなところで損をしてしまいます。

## settingsフォルダの位置
settingの分割にトライしてくれたと思うのですが、myappの直下に作るのではなく、internの直下に作ってください。設定はプロジェクトの中の１アプリに関するものではなく、プロジェクト全体に関わるものだからです。前見た時に配置に気付けずごめんなさい。

## BASE_DIRのstrict=Trueについて
おそらく何かしらの意図があってのことだと思うのですが、strict=Trueはつけないでください。
例えば存在しないパスにアクセスしただけでエラーで落ちてしまいます。
本番環境では404 Not Foundが表示されるようになっています。
これがエラーで落ちると大変です。
開発環境でも、strict=Trueにする利点は特にないと思います・・・

## 設定ページの表記について
ユーザ名変更のところで「新しいメールアドレス」に、
メールアドレス変更のところで「新しいユーザー名」と表記が逆転していて、多分そんなに難しくないので修正してみてください。

## SessionFormの名前について
セッションとは、ブラウザが一時的に記憶する辞書型の情報の総称であり、今回はワンタイムパスコード(OTP)という具体的に入力するものがあるので、OTPFormなどの方が名前としてbetterだと思います。
実際、OTP以外にもuser_idなどそれ以外のsessionもあり、混乱の元になってしまいます。

## friendsのクエリ最適化について
すごいよくかけています。  
select_related,prefetch_related,更にはPrefetchも上手に使っていて、N+1問題に対する理解も深いのかなと思いました。
それこそselect_relatedとprefetch_relatedの違いなど、深い部分まで踏み込んでくれたのかなと思います。
この項目は少し高度なので、参考程度に読んでください。


実は、python側ではなくSQL側でTalkの最新の一件だけを取得するようにするともっと高速化します。
その方が早い理由は、pythonでmaxをとると、まずは一旦Talkを全部持ってきて、そこから最大のものを取らないといけず、その分Pythonメモリを消費するからです。
それよりも、データベース(DB)から必要なものだけを選んで取ってくる方が速くなります。

djangoでは、直接SQLを操作しなくても、pythonの文法でデータベース(DB)を操作できる機能を、django ORMと言いました。(実践django2章など)  
django ORMはとても充実していて、def-initの「高度なORM」というChapterを見てもらうと実に色々なものがあることが分かると思います。  

そして、その中のannotateやSuquery、OuterRefといったものを用いることでデータベースレベルで最新のものを取ってくることができます。

実際にdef-initにサンプルコードが載っているので、ぜひどうやって実装するか考えてみてください！

## ALLOWD_HOSTSについて
おそらく、デプロイするときにうまく動かなくて、対処法として
```
ALLOWED_HOSTS = ["*"]
```
としてくれたと思うのですが、*はセキュリティの観点から使わない方が良いです。
ALLOWED_HOSTSはそのアプリにアクセスできるIPを指定するものです。デフォルトでは空に成っていますが、debug=Trueの時だけ、localhostのみ許可するようになっています。
デプロイし、本番環境で使う時はElasticIPなど本番用のIPをそこに指定するのですが、つまり、開発環境と本番環境でALLOED_HOSTSの値は変わるのが普通です。
settings.pyを分割するのは、そうした切替を効率的に行うためになります。

## 環境変数.envについて
postgresを導入するにあたって、おそらくうまく.envを活用してくれてniceです。実はSECRET_KEYも、.envに分離した方が良いです。
暗号化等に関わる部分で、openでないほうが良いです。

## viewの場合分けロジックについて
以下のように、ifとelifで場合分けしてくれても十分動くのですが、if/else構造にした方が可読性が上がるのでお勧めです。

```
if request.method == "GET":
        form = SignUpForm()
        error_message = ''
elif request.method == "POST":
```

また、GETとPOSTでそれぞれifやelifを使っても良いのですが、基本的にはPOSTの場合にifを用い、GETを含めそれ以外をelseにするとより可読性があると思います。

また、**early return**を用いるとif文のネストが減り、可読性が良くなります。
デフォルトをelseの処理にするイメージです。

この[記事](https://qiita.com/komekome111/items/af010f60b6da52a7a90c)とか分かりやすいかもしれません。

ただ、常に可読性が上がるかが大事であり、常にearly returnを用いるのが正解とは限らないため、テクニックの一つとして覚えつつ、使うべきかどうかを検討できると良いと思います。
