お疲れ様です。
とてもよくできていると思います！
この調子で頑張ってください！

## requirements.txtの更新について

今回の課題で、pycopgなど新たに追加したpackageがあると思うので、あらたにpackageを追加したときは、
```
pip freeze > requirements.txt
```

を実行し、更新するようにしましょう！

## メールアドレスログインについて

教材が変わってわかりにくくなってしまっていたのですが、今回の課題の内容には「メールアドレスでログイン」するも実は含まれていました。
ユーザーネームでログインするよりも、メールアドレスとパスワードでログインする場合の方がユニーク性を持たせるのに適切だからです。
(実際、多くのアプリではメールアドレスによるログインor Googleアカウントなどの他のアプリと連携した認証が主流になっています。ちなみに、他のアプリと連携した認証をOAuth認証といいます。)

AbstractUserのUSERNAME_FIELDをいじり、それに合わせてREQUIRED_FIELDを変更するなどで、割と簡単に実装できるので調べてみてください！

## 会員登録フォームのUI
バックエンドの課題なのでスタイリングは今回は最重要事項ではないのですが、ユーザーが混乱するのはよくないので、username,password,password-confirmation,email,user-iconの順ではなく、username,email,user-icon,password,passoword-confirmationの方が自然だと思います。
formsのfieldsの順番を入れ替えるだけなのでそんなに難しい修正ではないかなと思います。

## ログアウトできない
ログアウトボタンでログアウトしようとすると405 Method Not Allowedが発生しています。
前回のレビューを受けてLogoutというCBVにトライしてくれたと思うのですが、ログインがPOSTでしか受け付けないようになりました。
設定ページにあるログアウトボタンはaタグで実装されており、これだとGETによるリクエストになってしまうので、formにしてmethodwo
postにするなどがおすすめです。

## フォームクラスの名前
```
class MailSettingForm(forms.ModelForm):
```
よりも
```
EmailSettingForm
```
の方が良いです。Mailは英語では郵便物です。

同様に、
```
path("mail_change_done/", views.mail_change_done, name="mail_change_done"),
```
も修正すると良いと思います。

## 2段階認証のフロー

ログインするときに、ログインフォームとワンタイムパスコード入力フォームが同時にでて、どちらかが空だとログインできないという不具合が起きていたので、ぜひ修正しましょう！
二段階のフェーズなので、True/FalseのBooleanを用いてtemplateをみえたりみえなくしたりすると良いと思います。

## 会員登録の不具合

多分、課題2,3としては一旦動く形で完成させてくれていて、追加で後会員登録時のメールアドレス認証を実装してくれている途中だと思うのですが、画像がきちんとアップロードされなくなってしまっているので、ぜひうまくいくようにトライしてみてください！

## talk_roomのN+1問題
友達一覧画面のN+1問題は見事に解決してくれたのですが、実はトークルームの方もN+1問題を抱えています。
実際に、メッセージを1件送るたびに、debug-toolbarのsqlの数が1増えることが確認できるのでやってみてください。
しかし、for文を使ってその回数だけqueryを発行していた友達一覧画面と比べ、トークルームの方はたった一言ORMを追加するだけでこの問題を解決することができます。djangoにおいてN+1問題を解決する定番の方法なのでぜひ調べて解決してみてください！

## BASE_DIRのstrict=Trueについて
おそらく何かしらの意図があってのことだと思うのですが、strict=Trueはつけないでください。
例えば存在しないパスにアクセスしただけでエラーで落ちてしまいます。
本番環境では404 Not Foundが表示されるようになっています。
これがエラーで落ちると大変です。
開発環境でも、strict=Trueにする利点は特にないと思います・・・

## ALLOWD_HOSTについて
おそらく、デプロイするときにうまく動かなくて、対処法として
```
ALLOWED_HOSTS = ["*"]
```
としてくれたと思うのですが、*はセキュリティの観点から使わない方が良いです。
ALLOWED_HOSTSはそのアプリにアクセスできるIPを指定するものです。デフォルトでは空に成っていますが、debug=Trueの時だけ、localhostのみ許可するようになっています。
デプロイし、本番環境で使う時はElasticIPなど本番用のIPをそこに指定するのですが、つまり、開発環境と本番環境でALLOED_HOSTSの値は変わるのが普通です。
そうした切り替えは、面倒くさいので、settings.pyを分割するのがよくある手法です。
開発入門等にも載っているので、ぜひ参考にチャレンジしてみてください！